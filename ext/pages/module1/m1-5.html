<!DOCTYPE html>
<html lang="nl" data-theme="light" data-color="red">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create & Store - Laravel 12 Module 1</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../style.css">
</head>
<body>

<header>
    <a href="../../index.html" class="logo">
        <svg width="30" height="30" viewBox="0 0 100 100" fill="currentColor"><path d="M50 0L10 20L10 80L50 100L90 80L90 20L50 0Z"/></svg>
        Laravel 12
    </a>
    <div class="header-controls">
        <button class="btn-control" id="color-toggle">ðŸŽ¨ Kleur</button>
        <button class="btn-control" id="theme-toggle">ðŸŒ“ Thema</button>
        <button class="mobile-menu-btn" id="menu-toggle">â˜°</button>
    </div>
</header>

<div class="layout-wrapper">
    <nav class="sidebar-left">

        <div class="nav-group">
            <h3>Cursus Modules</h3>

            <div class="nav-item-container">
                <button class="nav-toggle">
                    Module 1: Basis CRUD
                    <svg class="chevron" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
                </button>
                <ul class="submenu" style="display:block;">
                    <li><a href="m1-1.html">Model & Migration</a></li>
                    <li><a href="m1-2.html">Factory & Seeding</a></li>
                    <li><a href="m1-3.html">Layouts & Tailwind</a></li>
                    <li><a href="m1-4.html">Controller Index</a></li>
                    <li><a href="m1-5.html" class="current">Create & Store</a></li>
                    <li><a href="m1-6.html">Validatie & Flash</a></li>
                    <li><a href="m1-7.html">Detailpagina (Show)</a></li>
                    <li><a href="m1-8.html">Edit & Update</a></li>
                    <li><a href="m1-9.html">Delete & Destroy</a></li>
                </ul>
            </div>

            <div class="nav-item-container">
                <button class="nav-toggle">
                    Module 2: Users & Security
                    <svg class="chevron" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
                </button>
                <ul class="submenu">
                    <li><a href="../module2/m2-1.html">Publieke Layout</a></li>
                    <li><a href="../module2/m2-2.html">Simpele Publieke Pagina</a></li>
                    <li><a href="../module2/m2-3.html">Roles & Permissions</a></li>
                    <li><a href="../module2/m2-4.html">Aanmaken van Users</a></li>
                    <li><a href="../module2/m2-5.html">Middleware bij Routes</a></li>
                    <li><a href="../module2/m2-6.html">Rolgebaseerde Toegang</a></li>
                </ul>
            </div>

            <div class="nav-item-container">
                <button class="nav-toggle">
                    Module 3: Advanced Admin
                    <svg class="chevron" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
                </button>
                <ul class="submenu">
                    <li><a href="../module3/m3-1.html">Models & Migrations</a></li>
                    <li><a href="../module3/m3-2.html">Factories met Relaties</a></li>
                    <li><a href="../module3/m3-3.html">Seeders met Relaties</a></li>
                    <li><a href="../module3/m3-4.html">Index & Eager Loading</a></li>
                    <li><a href="../module3/m3-5.html">Permissions</a></li>
                    <li><a href="../module3/m3-6.html">Create & Dropdowns</a></li>
                    <li><a href="../module3/m3-7.html">Store & Validatie</a></li>
                    <li><a href="../module3/m3-8.html">Show & Relaties</a></li>
                    <li><a href="../module3/m3-9.html">Edit & Pre-select</a></li>
                    <li><a href="../module3/m3-10.html">Update & Logica</a></li>
                    <li><a href="../module3/m3-11.html">Delete View</a></li>
                    <li><a href="../module3/m3-12.html">Destroy & Constraints</a></li>
                </ul>
            </div>

            <div class="nav-item-container">
                <button class="nav-toggle">
                    Module 4: Webshop Features
                    <svg class="chevron" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
                </button>
                <ul class="submenu">
                    <li><a href="../module4/m4-1.html">Publieke Productpagina</a></li>
                    <li><a href="../module4/m4-2.html">De Product Show</a></li>
                    <li><a href="../module4/m4-3.html">Reviews Setup (DB)</a></li>
                    <li><a href="../module4/m4-4.html">Reviews Tonen</a></li>
                    <li><a href="../module4/m4-5.html">Reviews Plaatsen</a></li>
                    <li><a href="../module4/m4-6.html">Winkelwagen Setup</a></li>
                    <li><a href="../module4/m4-7.html">Winkelwagen Tonen</a></li>
                    <li><a href="../module4/m4-8.html">Winkelwagen Wijzigen</a></li>
                </ul>
            </div>

            <div class="nav-item-container">
                <button class="nav-toggle">
                    Module 5: Orders & Validatie
                    <svg class="chevron" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
                </button>
                <ul class="submenu">
                    <li><a href="../module5/m5-1.html">Orders Structuur</a></li>
                    <li><a href="../module5/m5-2.html">Order Seeds</a></li>
                    <li><a href="../module5/m5-3.html">Orders Opslaan</a></li>
                    <li><a href="../module5/m5-4.html">Orders Tonen</a></li>
                    <li><a href="../module5/m5-5.html">Order naar PDF</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <h1>Resource Controller: Create & Store</h1>
        <p>In deze module gaan we verder met het bouwen van de CRUD. We hebben de Index (het overzicht) al gemaakt. Nu is het tijd om nieuwe data toe te voegen. Hiervoor hebben we twee onderdelen nodig: de <strong>Create</strong> (het tonen van het formulier) en de <strong>Store</strong> (het opslaan van de gegevens).</p>

        <h2 id="create">Create Methode</h2>
        <p>De <code>create</code> methode in de controller heeft als enige doel om een formulier te tonen waarmee we een nieuwe categorie kunnen aanmaken. We hoeven hier nog geen ingewikkelde data op te halen of te verwerken; dat gebeurt later bij de <code>store</code> methode.</p>

        <p>In de controller hoeven we dus alleen de juiste view (het formulier) terug te geven:</p>

        <pre><code class="language-php">
/**
 * Show the form for creating a new resource.
 */
public function create(): View
{
    return view('admin.categories.create');
}
        </code></pre>

        <p>Vergeet niet om bovenin je bestand de <code>View</code> class te importeren voor de type-hinting (<code>use Illuminate\View\View;</code>).</p>

        <h2 id="create-view">De Create View (Het Formulier)</h2>
        <p>We maken een nieuw bestand aan: <code>resources/views/admin/categories/create.blade.php</code>. Omdat we dezelfde lay-out willen gebruiken als bij de index, nemen we de masterpage (<code>layoutadmin</code>) over.</p>

        <h3 id="navigatie">Topmenu en Navigatie</h3>
        <p>Voor de gebruiksvriendelijkheid is het belangrijk dat je makkelijk kunt navigeren tussen het overzicht en het aanmaakformulier. Daarom voegen we in de <code>topmenu</code> sectie een link toe waarmee je terug kunt naar de index.</p>

        <pre><code class="language-html">
@section('topmenu')
    &lt;nav class="card"&gt;
        &lt;div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"&gt;
            &lt;div class="relative flex items-center justify-between h-16"&gt;
                &lt;div class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start"&gt;
                    &lt;div class="sm:block sm:ml-6"&gt;
                        &lt;div class="flex space-x-4"&gt;
                            &lt;a href="{{ route('admin.categories.index') }}" class="text-gray-800 px-3 py-2 rounded-md text-sm font-medium"&gt;
                                &lt; Terug naar overzicht
                            &lt;/a&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/nav&gt;
@endsection
        </code></pre>

        <h3 id="formulier">Het Formulier en Beveiliging</h3>
        <p>Nu gaan we het formulier zelf maken. Er zijn een paar cruciale punten waar je op moet letten bij het maken van een formulier in Laravel:</p>
        <ul>
            <li><strong>Action:</strong> Waar moet de data heen gestuurd worden? We gebruiken hiervoor de named route <code>admin.categories.store</code> (of <code>categories.store</code> afhankelijk van je route definitie).</li>
            <li><strong>Method:</strong> We gebruiken <code>POST</code> om gegevens te versturen.</li>
            <li><strong>CSRF Token:</strong> Dit is een verplichte beveiliging in Laravel.</li>
        </ul>

        <pre><code class="language-html">
@section('content')
    &lt;div class="card mt-6"&gt;
        &lt;div class="card-body"&gt;
            &lt;form action="{{ route('admin.categories.store') }}" method="POST" class="shadow-md rounded-lg px-8 pt-6 pb-8 mb-4"&gt;
                @csrf

                &lt;div class="mb-4"&gt;
                    &lt;label class="block text-gray-700 text-sm font-bold mb-2" for="name"&gt;
                        Naam
                    &lt;/label&gt;
                    &lt;input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                           id="name" name="name" type="text" placeholder="Naam categorie"&gt;
                &lt;/div&gt;

                &lt;button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit"&gt;
                    Toevoegen
                &lt;/button&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
@endsection
        </code></pre>

        <h3 id="csrf">CSRF Beveiliging</h3>
        <div class="info-box" style="background: var(--bg-content); border: 1px solid var(--border-color); padding: 1rem; border-radius: 0.5rem;">
            <strong>Waarom @csrf?</strong><br>
            CSRF staat voor <em>Cross-Site Request Forgery</em>. Zonder deze beveiliging zou een hacker op een andere (kwaadaardige) website een formulier kunnen maken dat gegevens naar <em>jouw</em> applicatie stuurt, zonder dat de gebruiker dit doorheeft. De gebruiker is immers ingelogd op jouw site.
            <br><br>
            Laravel genereert een geheime token (de CSRF-token) die in de sessie van de gebruiker wordt opgeslagen. Met de <code>@csrf</code> code zet je dit token als een onzichtbaar veld in je formulier. Bij het ontvangen van het formulier controleert Laravel of de token uit het formulier overeenkomt met de token in de sessie. Zo weet Laravel zeker dat het formulier echt vanaf jouw website komt en niet van een hacker.
        </div>

        <h2 id="store">Store Methode</h2>
        <p>Wanneer de gebruiker op "Toevoegen" klikt, wordt de data via een POST-request naar de <code>store</code> methode in de controller gestuurd. Hier vangen we de data op via de <code>Request $request</code> variabele.</p>

        <h3 id="mass-assignment">Mass Assignment Beveiliging</h3>
        <p>Je zou kunnen denken dat je de data heel simpel in Ã©Ã©n keer kunt opslaan met:</p>
        <pre><code class="language-php">Category::create($request->all());</code></pre>

        <p>Maar let op: Laravel staat dit standaard niet toe. Dit komt door de <strong>Mass Assignment</strong> beveiliging. Wat houdt dit in?</p>

        <div class="info-box" style="background: var(--bg-content); border: 1px solid var(--border-color); padding: 1rem; border-radius: 0.5rem;">
            <strong>Het gevaar van Mass Assignment</strong><br>
            Stel je voor dat je een tabel 'users' hebt met een kolom <code>is_admin</code>. Normaal gesproken zit dit veld niet in je registratieformulier. Maar een hacker kan via de 'Inspect Element' tool van de browser stiekem een extra invoerveld toevoegen met de naam <code>is_admin</code> en de waarde <code>1</code>.
            <br><br>
            Als jij vervolgens in je controller blindelings <code>User::create($request->all())</code> gebruikt, slaat Laravel <em>alle</em> meegestuurde data op, inclusief de <code>is_admin</code> waarde van de hacker. De hacker heeft zichzelf nu admin gemaakt!
        </div>

        <p>Om dit te voorkomen, moet je in je Model (<code>app/Models/Category.php</code>) expliciet aangeven welke velden "veilig" zijn. Je hebt twee opties:</p>
        <ul>
            <li><strong>$fillable:</strong> Een "whitelist". Alleen de velden die hierin staan mogen via Mass Assignment gevuld worden.</li>
            <li><strong>$guarded:</strong> Een "blacklist". Alle velden mogen gevuld worden, <em>behalve</em> de velden die je hier noemt.</li>
        </ul>

        <p>Een voorbeeld met <code>$fillable</code> in je Model:</p>
        <pre><code class="language-php">
// app/Models/Category.php
protected $fillable = ['name'];
        </code></pre>

        <p>Of een voorbeeld met <code>$guarded</code> (vaak makkelijker, omdat je alles toestaat behalve de echt gevaarlijke dingen):</p>
        <pre><code class="language-php">
// app/Models/Category.php
// id, created_at en updated_at mag je nooit zomaar overschrijven
protected $guarded = ['id', 'created_at', 'updated_at'];
        </code></pre>

        <h3 id="oop-save">Alternatief: OOP manier (Veiliger)</h3>
        <p>Er is ook een andere manier om data op te slaan, die meer lijkt op de basis van Object Oriented Programming (OOP). Hierbij vul je het object stap voor stap. Omdat je elk veld handmatig toewijst, heb je hierbij <strong>geen</strong> last van Mass Assignment risico's en heb je <code>$fillable</code> of <code>$guarded</code> niet nodig voor dit stukje code.</p>

        <p>Dit ziet er zo uit in je controller:</p>

        <pre><code class="language-php">
// app/Http/Controllers/Admin/CategoryController.php

use Illuminate\Http\RedirectResponse; // Vergeet deze niet te importeren!

public function store(Request $request): RedirectResponse
{
    // 1. Maak een nieuw, leeg Category object aan (instantieren)
    $category = new Category();

    // 2. Vul de properties (eigenschappen) met de data uit het formulier
    $category->name = $request->name;

    // 3. Sla het object daadwerkelijk op in de database
    $category->save();

    // 4. Stuur de gebruiker terug naar de index pagina (redirect)
    // We gebruiken de moderne 'to_route' helper functie
    return to_route('admin.categories.index');
}
        </code></pre>

        <div class="info-box" style="background: var(--bg-content); border: 1px solid var(--border-color); padding: 1rem; border-radius: 0.5rem;">
            <strong>Let op: Redirects</strong><br>
            Na het opslaan wil je niet dat de gebruiker op een wit scherm eindigt of op de 'store' URL blijft hangen. Daarom sturen we de gebruiker terug naar het overzicht (de index). Vanaf Laravel 9 gebruiken we hiervoor de helper functie <code>to_route('naam.van.route')</code>. Dit is korter en leesbaarder dan de oude manier <code>redirect()->route(...)</code>.
        </div>

    </main>

    <aside class="sidebar-right">
        <div class="toc-container">
            <h4>Inhoud</h4>
            <ul id="toc-list" class="toc-list">
            </ul>
        </div>
    </aside>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="../../script.js"></script>
</body>
</html>