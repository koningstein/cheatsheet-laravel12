<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>HTTP Client - Services & Features - Laravel 12</title>
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="../../script.js" defer></script>
</head>
<body>
<div class="top-bar"><div class="top-bar-content"><div class="nav-group"><a href="../module11/m11-7.html">« Security & Auth</a><a href="../module13/m13-1.html">Quality Assurance »</a></div><div class="nav-group theme-switcher"><select id="theme-switcher"><option value="blue">Blauw</option></select></div></div></div>

<div class="container">
    <div class="header-nav-block">
        <header>
            <h1>Services & Features</h1>
            <p>Externe integraties, bestandsbeheer en systeemtaken.</p>
        </header>
        <nav>
            <ul>
                <li><a href="m12-1.html">PDF Generatie</a></li>
                <li><a href="m12-2.html">Excel Import & Export</a></li>
                <li><a href="m12-3.html">Mail & Notifications</a></li>
                <li><a href="m12-4.html">File Storage</a></li>
                <li><a href="m12-5.html" class="active">HTTP Client</a></li>
                <li><a href="m12-6.html">Events & Listeners</a></li>
                <li><a href="m12-7.html">Artisan Commands</a></li>
            </ul>
        </nav>
    </div>

    <main>
        <h2>HTTP Client (Communiceren met API's)</h2>
        <p>Moderne applicaties staan zelden op zichzelf. Ze communiceren met externe services: een weer-API, een betaalprovider (Mollie/Stripe), OpenAI, of interne microservices. Vroeger gebruikte je hiervoor Guzzle of cURL, wat nogal omslachtige code opleverde. Laravel biedt een prachtige wrapper om Guzzle heen: de <strong>Http Facade</strong>.</p>

        <h3>Waarom: Eenvoud en Leesbaarheid</h3>
        <p>De Http Facade maakt API calls leesbaar en testbaar. Je kunt eenvoudig headers toevoegen, authenticatie regelen en de response verwerken zonder in try-catch blokken te verdrinken.</p>

        <h3>Hoe: Een GET Request doen</h3>
        <p>Stel we willen weerdata ophalen van een externe API.</p>

        <div class="note-box">Bestand: <code>app/Services/WeatherService.php</code></div>
        <pre><code class="language-php">
use Illuminate\Support\Facades\Http;

public function getForecast(string $city)
{
    // Doe het request
    $response = Http::get('https://api.weather.com/v1/forecast', [
        'city' => $city,
        'apikey' => config('services.weather.key'),
    ]);

    // Check of het gelukt is (status 200-299)
    if ($response->successful()) {
        return $response->json(); // Geeft array terug
    }

    // Foutafhandeling
    if ($response->failed()) {
        // Log de error of gooi een exception
        throw new \Exception('Kan weerdata niet ophalen: ' . $response->status());
    }
}
        </code></pre>

        <h3>Hoe: Een POST Request met Authenticatie</h3>
        <p>Veel API's vereisen een Bearer Token. De Http client heeft hier handige helpers voor.</p>

        <pre><code class="language-php">
$response = Http::withToken('mijn-geheime-api-token')
    ->post('https://api.example.com/users', [
        'name' => 'Henk',
        'role' => 'admin',
    ]);

// Als je verwacht dat het altijd goed gaat, kun je throw() gebruiken.
// Dit gooit automatisch een Exception als de status code >= 400 is.
$data = $response->throw()->json();
        </code></pre>

        <h3>Testen (Mocking)</h3>
        <p>Het grootste voordeel van de Http Facade is tijdens het testen. Je wilt in je tests niet écht naar de externe API verbinden (traag, kost geld, offline niet mogelijk). Je kunt requests 'mocken' (faken).</p>

        <div class="note-box">Bestand: <code>tests/Feature/WeatherTest.php</code></div>
        <pre><code class="language-php">
Http::fake([
    'api.weather.com/*' => Http::response(['temp' => 20], 200),
]);

// Nu zal je applicatie denken dat het 20 graden is, zonder internetverbinding.
        </code></pre>
    </main>
</div>
<footer><div class="footer-content"><p>&copy; 2025 Techniek College Rotterdam</p></div></footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>