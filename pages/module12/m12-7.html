<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Artisan Commands - Services & Features - Laravel 12</title>
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="../../script.js" defer></script>
</head>
<body>
<div class="top-bar"><div class="top-bar-content"><div class="nav-group"><a href="../module11/m11-7.html">« Security & Auth</a><a href="../module13/m13-1.html">Quality Assurance »</a></div><div class="nav-group theme-switcher"><select id="theme-switcher"><option value="blue">Blauw</option></select></div></div></div>

<div class="container">
    <div class="header-nav-block">
        <header>
            <h1>Services & Features</h1>
            <p>Externe integraties, bestandsbeheer en systeemtaken.</p>
        </header>
        <nav>
            <ul>
                <li><a href="m12-1.html">PDF Generatie</a></li>
                <li><a href="m12-2.html">Excel Import & Export</a></li>
                <li><a href="m12-3.html">Mail & Notifications</a></li>
                <li><a href="m12-4.html">File Storage</a></li>
                <li><a href="m12-5.html">HTTP Client</a></li>
                <li><a href="m12-6.html">Events & Listeners</a></li>
                <li><a href="m12-7.html" class="active">Artisan Commands</a></li>
            </ul>
        </nav>
    </div>

    <main>
        <h2>Custom Artisan Commands</h2>
        <p>Je kent Artisan al van commando's als <code>php artisan migrate</code> of <code>php artisan make:controller</code>. Maar wist je dat je ook je eigen commando's kunt schrijven? Dit is extreem krachtig voor beheertaken, cronjobs en imports.</p>

        <h3>Waarom: Automatisering</h3>
        <p>Stel je wilt elke nacht om 03:00 uur alle onbetaalde bestellingen ouder dan 30 dagen annuleren. Of je wilt een script dat data importeert uit een CSV bestand zonder dat je daarvoor een webpagina hoeft te bouwen (die misschien timed-out). Hier zijn Artisan Commands voor bedoeld.</p>

        <h3>Hoe: Commando Maken</h3>
        <p>Gebruik <code>php artisan make:command CleanupOrders</code>. Dit maakt een bestand in <code>app/Console/Commands</code>.</p>

        <div class="note-box">Bestand: <code>app/Console/Commands/CleanupOrders.php</code></div>
        <pre><code class="language-php">
namespace App\Console\Commands;

use Illuminate\Console\Command;
use App\Models\Order;

class CleanupOrders extends Command
{
    // De 'signature' is wat je typt in de terminal
    // {days} is een optioneel argument met default waarde 30
    protected $signature = 'orders:cleanup {days=30}';

    protected $description = 'Annuleer onbetaalde orders ouder dan X dagen';

    public function handle()
    {
        // Argument ophalen
        $days = $this->argument('days');

        $this->info("Bezig met opruimen van orders ouder dan $days dagen...");

        // Logica uitvoeren
        $count = Order::where('status', 'pending')
            ->where('created_at', '<', now()->subDays($days))
            ->update(['status' => 'cancelled']);

        // Feedback geven aan de gebruiker (in de terminal)
        if ($count > 0) {
            $this->info("$count orders zijn geannuleerd.");
        } else {
            $this->warn("Geen orders gevonden om te annuleren.");
        }
    }
}
        </code></pre>

        <h3>Hoe: Uitvoeren en Plannen</h3>
        <p>Je kunt je commando nu direct testen in de terminal:</p>
        <div class="note-box">Terminal</div>
        <pre><code class="language-bash">php artisan orders:cleanup 7</code></pre>

        <p>Om dit automatisch te laten lopen, voeg je het toe aan de Scheduler in <code>routes/console.php</code> (in Laravel 11/12 is dit de nieuwe plek, ipv Kernel.php).</p>

        <div class="note-box">Bestand: <code>routes/console.php</code></div>
        <pre><code class="language-php">
use Illuminate\Support\Facades\Schedule;

// Voer het commando elke nacht uit
Schedule::command('orders:cleanup')->dailyAt('03:00');
        </code></pre>
    </main>
</div>
<footer><div class="footer-content"><p>&copy; 2025 Techniek College Rotterdam</p></div></footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>