<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Database Testing & Seeding - Quality Assurance - Laravel 12</title>
    <link rel="stylesheet" href="../../../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="../../../script.js" defer></script>
</head>
<body>
<div class="top-bar"><div class="top-bar-content"><div class="nav-group"><a href="../module12/m12-7.html">Â« Services & Features</a></div><div class="nav-group theme-switcher"><select id="theme-switcher"><option value="blue">Blauw</option></select></div></div></div>

<div class="container">
    <div class="header-nav-block">
        <header>
            <h1>Quality Assurance</h1>
            <p>Codekwaliteit, testen met PHPUnit, Pest & Dusk, en debugging.</p>
        </header>
        <nav>
            <ul>
                <li><a href="m13-1.html">Introductie & PHPUnit</a></li>
                <li><a href="m13-2.html">Unit vs Feature Tests</a></li>
                <li><a href="m13-3.html">Introductie Pest</a></li>
                <li><a href="m13-4.html">Unit & Feature Tests (Pest)</a></li>
                <li><a href="m13-5.html" class="active">Database Testing & Seeding</a></li>
                <li><a href="m13-6.html">Mocking & Spies</a></li>
                <li><a href="m13-7.html">Browser Testing (Dusk)</a></li>
                <li><a href="m13-8.html">Static Analysis & Debugging</a></li>
            </ul>
        </nav>
    </div>

    <main>
        <h2>Testen met de Database</h2>
        <p>Bijna elke Feature test heeft een database nodig. Als je een gebruiker aanmaakt in een test, wordt deze echt opgeslagen. Dit levert twee grote problemen op:</p>
        <ol>
            <li><strong>Vervuiling:</strong> Je test-database raakt vol met onzin-data ("test1", "asdasd").</li>
            <li><strong>State:</strong> Als test A een gebruiker verwijdert, faalt test B misschien omdat die gebruiker er niet meer is.</li>
        </ol>
        <p>Elke test moet beginnen met een schone lei. Laravel heeft hiervoor twee traits.</p>

        <h3>1. RefreshDatabase (De Standaard)</h3>
        <p>De <code>RefreshDatabase</code> trait is de moderne, snelle manier.
            <br><strong>Hoe werkt het?</strong> Het gebruikt database <em>transacties</em>. Voor elke test start een transactie. Alles wat je doet (users aanmaken, posts verwijderen) gebeurt binnen die transactie. Na de test voert Laravel een <code>ROLLBACK</code> uit.
            <br><strong>Resultaat:</strong> Er is nooit daadwerkelijk iets naar de harde schijf geschreven. De database is na de test exact zoals hij ervoor was. Dit is razendsnel.</p>

        <div class="note-box">Bestand: <code>tests/Pest.php</code> (of in je testfile)</div>
        <pre><code class="language-php">
use Illuminate\Foundation\Testing\RefreshDatabase;

// Activeer de trait voor alle Feature tests
uses(RefreshDatabase::class)->in('Feature');
        </code></pre>

        <h3>2. DatabaseMigrations (De Oude Manier)</h3>
        <p>Vroeger gebruikten we <code>DatabaseMigrations</code>.
            <br><strong>Hoe werkt het?</strong> Voor <em>elke</em> test worden alle tabellen uit de database gegooid (DROP) en worden alle migraties opnieuw gedraaid (MIGRATE).
            <br><strong>Resultaat:</strong> Dit is extreem traag, vooral als je veel tabellen hebt. Gebruik dit alleen als transacties niet werken (bijv. sommige MySQL fulltext features).</p>

        <h3>Seeding: Data Klaarzetten</h3>
        <p>Soms heb je basisdata nodig die in <em>elke</em> test aanwezig moet zijn, bijvoorbeeld een lijst met Rollen en Permissies. Je wilt dit niet in elke testfunctie opnieuw aanmaken.
            <br>Hiervoor gebruiken we de <code>beforeEach</code> functie in Pest (of <code>setUp</code> in PHPUnit).</p>

        <div class="note-box">Bestand: <code>tests/Feature/AdminTest.php</code></div>
        <pre><code class="language-php">
use Database\Seeders\RoleSeeder;

beforeEach(function () {
    // Deze code draait VOOR elke test in dit bestand.
    // De database is hier leeg (door RefreshDatabase).

    // We draaien de seeder om rollen aan te maken
    $this->seed(RoleSeeder::class);
});

test('admin can access dashboard', function () {
    // We kunnen nu direct een user met een rol maken,
    // omdat de rollen bestaan.
    $user = User::factory()->create();
    $user->assignRole('admin');

    $this->actingAs($user)
         ->get('/admin')
         ->assertStatus(200);
});
        </code></pre>

        <h3>Asserts: Controleren in de Database</h3>
        <p>Vaak wil je niet alleen weten of de pagina laadt, maar ook of de data correct is opgeslagen. Gebruik hiervoor <code>assertDatabaseHas</code>.</p>

        <pre><code class="language-php">
test('new project is stored in database', function () {
    $data = [
        'title' => 'Nieuw Project',
        'description' => 'Test omschrijving'
    ];

    // Act: Doe de POST request
    $this->post('/projects', $data);

    // Assert: Check of er een record is in de tabel 'projects'
    // die matcht met deze data
    $this->assertDatabaseHas('projects', [
        'title' => 'Nieuw Project',
        // We checken de omschrijving niet, puur als voorbeeld
    ]);

    // Of check dat iets er NIET is:
    // $this->assertDatabaseMissing('projects', ['title' => 'Oud Project']);
});
        </code></pre>
    </main>
</div>
<footer><div class="footer-content"><p>&copy; 2025 Techniek College Rotterdam</p></div></footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>