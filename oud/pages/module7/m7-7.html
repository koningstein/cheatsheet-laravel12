<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Pivot Tabellen - Eloquent ORM - Laravel 12</title>
    <link rel="stylesheet" href="../../../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="../../../script.js" defer></script>
</head>
<body>
<div class="top-bar"><div class="top-bar-content"><div class="nav-group"><a href="../module6/m6-8.html">« Database & Models</a><a href="../module8/m8-1.html">Routing & Controllers »</a></div><div class="nav-group theme-switcher"><select id="theme-switcher"><option value="blue">Blauw</option></select></div></div></div>

<div class="container">
    <div class="header-nav-block">
        <header>
            <h1>Eloquent ORM</h1>
            <p>Geavanceerd werken met data, relaties, accessors en scopes.</p>
        </header>
        <nav>
            <ul>
                <li><a href="m7-1.html">One to One</a></li>
                <li><a href="m7-2.html">One to Many</a></li>
                <li><a href="m7-3.html">Many to Many</a></li>
                <li><a href="m7-4.html">Eager Loading</a></li>
                <li><a href="m7-5.html">Query Scopes</a></li>
                <li><a href="m7-6.html">Collections Methods</a></li>
                <li><a href="m7-7.html" class="active">Pivot Tabellen</a></li>
            </ul>
        </nav>
    </div>

    <main>
        <h2>Pivot Tabellen (Met Data)</h2>
        <p>Bij een standaard Many-to-Many relatie (zoals User <-> Role) bevat de tussentabel (pivot table) alleen de twee foreign keys. Maar soms wil je <strong>extra informatie</strong> opslaan over die specifieke koppeling.</p>
        <p>Voorbeeld: <strong>Order & Product</strong>. Hoeveel stuks (<code>quantity</code>) en wat was de prijs (<code>price</code>)?</p>

        <h3>1. De Migratie (Extra Kolommen)</h3>
        <p>Je maakt de tussentabel aan en voegt extra kolommen toe.</p>

        <div class="note-box">Bestand: <code>database/migrations/xxxx_create_order_product_table.php</code></div>
        <pre><code class="language-php">
Schema::create('order_product', function (Blueprint $table) {
    $table->id();

    $table->foreignId('order_id')->constrained()->onDelete('cascade');
    $table->foreignId('product_id')->constrained()->onDelete('restrict');

    // Extra data
    $table->integer('quantity');
    $table->decimal('price', 8, 2);

    $table->timestamps();
});
        </code></pre>

        <h3>2. Model Configureren (withPivot)</h3>
        <p>Vertel Laravel welke extra kolommen hij moet ophalen met <code>withPivot()</code>.</p>

        <div class="note-box">Bestand: <code>app/Models/Order.php</code></div>
        <pre><code class="language-php">
public function products(): BelongsToMany
{
    return $this->belongsToMany(Product::class)
                ->withPivot('quantity', 'price')
                ->withTimestamps();
}
        </code></pre>

        <h3>3. Data Opslaan</h3>
        <p>Bij het koppelen (<code>attach</code>) geef je de extra data mee.</p>

        <pre><code class="language-php">
$order = Order::find(1);
$productId = 5;

// Koppel product 5 aan order 1, met aantal 3
$order->products()->attach($productId, [
    'quantity' => 3,
    'price' => 12.50
]);
        </code></pre>

        <h3>4. Data Ophalen</h3>
        <p>Je benadert de data via het <code>pivot</code> attribuut.</p>

        <pre><code class="language-html">
@foreach($order->products as $product)
    Product: {{ $product->name }} <br>

    Aantal: {{ $product->pivot->quantity }} <br>
    Prijs: € {{ $product->pivot->price }}
@endforeach
        </code></pre>

        <h3>5. Updaten</h3>
        <p>Gebruik <code>updateExistingPivot</code> om data in de tussentabel aan te passen.</p>

        <pre><code class="language-php">
$order->products()->updateExistingPivot($productId, [
    'quantity' => 10
]);
        </code></pre>
    </main>
</div>
<footer><div class="footer-content"><p>&copy; 2025 Techniek College Rotterdam</p></div></footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>