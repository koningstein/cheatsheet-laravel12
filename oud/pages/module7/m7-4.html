<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Eager Loading - Eloquent ORM - Laravel 12</title>
    <link rel="stylesheet" href="../../../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="../../../script.js" defer></script>
</head>
<body>
<div class="top-bar"><div class="top-bar-content"><div class="nav-group"><a href="../module6/m6-8.html">« Database & Models</a><a href="../module8/m8-1.html">Routing & Controllers »</a></div><div class="nav-group theme-switcher"><select id="theme-switcher"><option value="blue">Blauw</option></select></div></div></div>

<div class="container">
    <div class="header-nav-block">
        <header>
            <h1>Eloquent ORM</h1>
            <p>Geavanceerd werken met data, relaties, accessors en scopes.</p>
        </header>
        <nav>
            <ul>
                <li><a href="m7-1.html">One to One</a></li>
                <li><a href="m7-2.html">One to Many</a></li>
                <li><a href="m7-3.html">Many to Many</a></li>
                <li><a href="m7-4.html" class="active">Eager Loading</a></li>
                <li><a href="m7-5.html">Query Scopes</a></li>
                <li><a href="m7-6.html">Collections Methods</a></li>
                <li><a href="m7-7.html">Pivot Tabellen</a></li>
            </ul>
        </nav>
    </div>

    <main>
        <h2>Eager Loading (N+1 Probleem)</h2>
        <p>Het N+1 probleem maakt je applicatie traag. Het ontstaat wanneer je in een loop steeds opnieuw een database query uitvoert om een relatie op te halen.</p>

        <h3>1. Het Probleem (Lazy Loading)</h3>
        <p>Stel je toont 100 producten en wilt hun categorie naam zien.</p>

        <div class="note-box">Bestand: <code>app/Http/Controllers/ProductController.php</code></div>
        <pre><code class="language-php">
// Query 1: Haal alle producten
$products = Product::all();

foreach ($products as $product) {
    // FOUT: Hier voer je voor ELK product een nieuwe query uit!
    // Query 2 t/m 101: SELECT * FROM categories WHERE id = X
    echo $product->category->name;
}
        </code></pre>
        <p>Resultaat: <strong>101 queries</strong>.</p>

        <h3>2. De Oplossing (Eager Loading)</h3>
        <p>Met <code>with()</code> haal je de relaties vooraf op. Laravel doet dan 2 geoptimaliseerde queries.</p>

        <div class="note-box">Bestand: <code>app/Http/Controllers/ProductController.php</code></div>
        <pre><code class="language-php">
// Query 1: Producten
// Query 2: Categorieën (WHERE id IN (...))
$products = Product::with('category')->get();

foreach ($products as $product) {
    // Geen extra query meer, data is al binnen!
    echo $product->category->name;
}
        </code></pre>

        <h3>3. Lazy Eager Loading</h3>
        <p>Als je het model al hebt (bijv. via Route Model Binding) en je wilt <em>alsnog</em> efficiënt laden:</p>

        <pre><code class="language-php">
public function show(Product $product)
{
    // Laad de relatie achteraf in
    $product->load('category');

    return view('products.show', ['product' => $product]);
}
        </code></pre>
    </main>
</div>
<footer><div class="footer-content"><p>&copy; 2025 Techniek College Rotterdam</p></div></footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>